<!DOCTYPE html>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        th, td, p, input, h3 {
            font:15px 'Segoe UI';
        }
        table, th, td {
            border: solid 1px #ddd;
            border-collapse: collapse;
            padding: 2px 3px;
            text-align: center;
        }
        th {
            font-weight:bold;
        }
    </style>
</head>
<body id="mainbody">
    
    <p id='showData'></p>
  
    <div class="container">
        <input type="text">
    </div>
</body>
</html>

<script type="text/javascript">
    var _row = null;
    async function delete_from_db(btn_id) 
        {
            console.log("inside delete from db");
            const title = btn_id
            const result = await fetch('/api/delete_adv', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    title
                })
            }).then((res) => res.json())
               
            if(result.status == 'error'){
                
                alert(result.error)
                stat = false;
            }
            else{
                stat=true;
                alert(result.status)
            }
        }
    function deleteadv(ctl){
        $(ctl).parents("tr").remove();
        delete_from_db(ctl.id);
    }
    function editadv(ctl){
        _row = $(ctl).parents("tr");
        var cols = _row.children("td");
        $("#title").val($(cols[1]).text());
        $("#introdate").val($(cols[2]).text());
        $("#url").val($(cols[3]).text());
        
        // Change Update Button Text
        $("#updateButton").text("Update");
    }
    var data_list = '<%- (data) %>';

    const data_obj = JSON.parse (data_list)         

     $(document).ready(function(){
            // $('#advertisment_title').text(data_obj[i].title);
            // $('#image_advrtisment').attr('src', data_obj[i].style);
            // $('#mainbody').append(data_obj);
            // for(i=0;i<data_obj.length;i++){
                
            // }
            // console.log(Object.keys(data_obj[0]));
            var col = [];
            for (var i = 0; i < data_obj.length; i++) {
                for (var key in data_obj[i]) {
                    if (col.indexOf(key) === -1) {
                        col.push(key);
                    }
                }

            }
            var table = document.createElement("table");
            col.push("Action");
            var tr = table.insertRow(-1); 

            // titles
            for(var i = 0; i< Object.keys(data_obj[0]).length; i++){
                var th = document.createElement("th");     
                th.innerHTML = col[i];
                tr.appendChild(th);
            }
            var th = document.createElement("th");     
                th.innerHTML = "Action";
                tr.appendChild(th);
            // data
            for(var i=0;i<data_obj.length;i++){
                tr = table.insertRow(-1);

                for (var j = 0; j < col.length; j++) {
                    var tabCell = tr.insertCell(-1);
                    tabCell.innerHTML = data_obj[i][col[j]];
                    
                }
                var advertise_id = data_obj[i].title;
                var tabCell = tr.insertCell(-1);
                tabCell.innerHTML = "<input id='edit_btn' type='button' onclick='editadv(this);' value='Edit'/>" + "<input id='"+advertise_id+"'   type='button' onclick='deleteadv(this);' value='Delete'/>";
            }
            var divShowData = document.getElementById('showData');
            divShowData.innerHTML = "";
            divShowData.appendChild(table);
            
        }

     ); 

</script>